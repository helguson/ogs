<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8"></meta>
		<title>D3Test</title>
		<script type="text/javascript" src="http://mbostock.github.com/d3/d3.js"></script>
		<script type="text/javascript" src="./infovis.js"></script>
		<script type="text/javascript">

			var GATE_ANNOUNCEMENT_NAME = "gate";

			function onLoad(){

				removeMessageOfUnavailabilityOfJavaScript();

				if(isD3Available()){

					setUpSampleSVG();

					if(isQtPresent()){

						setUpEventPassingFromQtToJS();
						setUpEventPassingFromJSToQt();
					}
					else{

						console.warn("Qt is not present.");
					}
				}
				else{

					console.warn("d3.js is not available. Execution was canceled.");
				}

				if(window[GATE_ANNOUNCEMENT_NAME] != undefined){

					window[GATE_ANNOUNCEMENT_NAME].transferredData.connect(onTransferredData);
				}
				else{

					console.warn("'gate' is not present");
				}
			}

			var lastReceivedData = [];
			var lastReceivedMetaData = [];

			function onTransferredData(values, metaDataRelation){

				// test: access values
				var message = "";
				for(var i = 0; i < 50; i++){

					message = message + values[i].toString() + ",";
				}
				console.log(message);

				// test: access value and its meta data
				console.log("started test");

				var counter = 0;
				var meta = function(baseIndex){
					counter++;
					var result = values[baseIndex].toString();

					if(metaDataRelation[baseIndex].length > 0 && counter < 50){

						result += "(";

						for(var i = 0; i < metaDataRelation[baseIndex].length; i++){
							if(i != 0){
								result += ", ";
							}
							result += meta(metaDataRelation[baseIndex][i]);
						}

						result += ")";
					}


					return result;
				}

				console.log("[500]: " + meta(500));
				console.log("finished test");
/*

				lastReceivedData = data;
				lastReceivedMetaData = metaData;
*/			}

			function onClick(){

				console.log("element '0' of lastReceivedData: " + printDataRow(lastReceivedMetaData ,lastReceivedData[0]));
			}

		</script>
	</head>
	<body onload="onLoad()" onclick="onClick()">
		<div id="viz">
				<p id="javaScriptNotExecutedDummy">JavaScript was not executed</p>
		</div>
	</body>
</html>
