<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8"></meta>
		<title>D3Test</title>
		<script type="text/javascript" src="http://mbostock.github.com/d3/d3.js"></script>
		<script type="text/javascript" src="./infovis.js"></script>
		<script type="text/javascript">

			function onLoad(){

				removeMessageOfUnavailabilityOfJavaScript();

				if(isD3Available()){

					setUpSampleSVG();

					if(isQtPresent()){

						setUpEventPassingFromQtToJS();
						setUpEventPassingFromJSToQt();
					}
					else{

						console.warn("Qt is not present.");
					}
				}
				else{

					console.warn("d3.js is not available. Execution was canceled.");
				}

				if(window["gate"] != undefined){
					gate.announcedData.connect(onAnnouncedData);
				}
				else{

					console.warn("'gate' is not present");
				}
			}

			var lastReceivedData = [];
			var lastReceivedMetaData = [];

			function onAnnouncedData(metaDataName, dataName){

				console.log("announced: " + metaDataName + ", " + dataName);

				var metaData = window[metaDataName];
				var data = window[dataName];

				console.log(metaData);
				console.log(data);

				console.log("starting test");
				console.log(metaData.getForDataColumnScope(2, "name"));
				console.log(data.m_data)
				console.log("passed test");
/*
				console.log("element '0' of received data: " + printDataRow(metaData, data[0]));

				lastReceivedData = data;
				lastReceivedMetaData = metaData;
*/			}

			function onClick(){

				console.log("element '0' of lastReceivedData: " + printDataRow(lastReceivedMetaData ,lastReceivedData[0]));
			}

			function printDataRow(metaData, dataRow){

				var message = "";
				var isFirstElement = true;

				for(var columnIndex = 0; columnIndex < dataRow.length; columnIndex++){

					if(isFirstElement){

						isFirstElement = false;
					}
					else{

						message += ", ";
					}
					message += metaData.getForDataColumnScope(columnIndex, "name").toString() + ":" + dataRow[columnIndex].toString();
				}

				return message;
			}
		</script>
	</head>
	<body onload="onLoad()" onclick="onClick()">
		<div id="viz">
				<p id="javaScriptNotExecutedDummy">JavaScript was not executed</p>
		</div>
	</body>
</html>
